const express = require("express");
const bodyParser = require("body-parser");
const path = require("path");
const shell = require("shelljs");
const cors = require("cors");
const multer = require("multer");
const fs = require("fs");

const app = express();
const PORT = 3001;

app.use(cors()); // Middleware to enable CORS
app.use(bodyParser.json()); // Middleware to parse JSON requests

// Destination folder for the received PDF files
const storage = multer.diskStorage({
  destination: "/home/kali/Documents/pdf-cracker/PDFs",
  filename: (req, file, cb) => {
    cb(null, file.originalname);
  },
});
const upload = multer({ storage });

app.post("/upload-and-crack-pdf", upload.single("pdfFile"), (req, res) => {
  const pdfFilePath = req.file.path; // Path to the saved PDF file

  if (fs.existsSync(pdfFilePath)) {
    console.log("PDF Received");
    const output = shell.exec(
      `/home/kali/Documents/pdf-cracker/crack-PDF-passwd ${pdfFilePath}`
    );
    return res.send(output.stdout);
  }
});

app.post("/clear-john-cache", (req, res) => {
  const output = shell.exec("/home/kali/Documents/pdf-cracker/clear-john-cache");
  return res.send(output.stdout);
});

app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});
