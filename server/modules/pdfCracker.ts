import express from 'express';
import multer from 'multer';
import shell from 'shelljs';
import fs from 'fs';

const router = express.Router();

// Destination folder for the received PDF files
const storage = multer.diskStorage({
    destination: "../pdf-cracker/PDFs",
    filename: (req, file, cb) => {
        cb(null, file.originalname);
    },
});
const upload = multer({ storage });

router.post("/upload-and-crack-pdf", upload.single("pdfFile"), (req, res) => {
    const pdfFilePath = req.file.path; // Path to the saved PDF file

    if (fs.existsSync(pdfFilePath)) {
        console.log("PDF Received");
        const output = shell.exec(
            `../pdf-cracker/crack-PDF-passwd ${pdfFilePath}`
        );
        return res.send(output.stdout);
    }
});

router.post("/clear-john-cache", (req, res) => {
    const output = shell.exec(
        "../pdf-cracker/clear-john-cache"
    );
    return res.send(output.stdout);
});

export default router;
