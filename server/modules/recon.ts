import { spawn } from "child_process";

export function handleNmapScan(ws, data) {
  const { command } = data;

  if (!command) {
    ws.send(JSON.stringify({ type: "error", data: "Command is required" }));
    return;
  }

  const parts = command.split(" ");
  const cmd = parts[0];
  const args = parts.slice(1);

  const child = spawn(cmd, args);

  child.stdout.on("data", (data) => {
    ws.send(JSON.stringify({ type: "nmap-scan", data: data.toString() }));
  });

  child.stderr.on("data", (data) => {
    ws.send(JSON.stringify({ type: "error", data: data.toString() }));
  });

  child.on("close", (code) => {
    ws.send(
      JSON.stringify({
        type: "nmap-scan-done",
        data: `child process exited with code ${code}`,
      })
    );
  });
}
